"use strict";(self.webpackChunkc=self.webpackChunkc||[]).push([[646],{2646:(e,t,n)=>{n.r(t),n.d(t,{SlateEditor:()=>Y,default:()=>L});var s=n(5893),i=n(7294),r=n(3146),o=n(7553);const c="_0Ur6k",a="_0me9V",l="sou-Y",f="_48S5O",u="epbFE";var d=n(6026),p=n(5732);const h={insertEmote(e,t,n=e.selection){if(6===t.type)return e.insertText(t.source+" ");const s={type:"e",data:t,children:[{text:""}]};r.YR.insertNodes(e,s,{at:n,select:!0});const i=r.ML.next(e);i&&r.YR.select(e,{path:i[1],offset:0})}};var x=n(1611),j=n(3323);function m({element:e,attributes:t,children:n}){return(0,s.jsx)("div",Object.assign({},t,{className:a},{children:n}))}function b({element:e,attributes:t,children:n}){const{data:i}=e,r=(0,o.vt)();return(0,s.jsxs)("span",Object.assign({},t,{className:(0,j.cn)(r&&f)},{children:[(0,s.jsx)(p.A0,Object.assign({},i,{label:!0})),n,(null==i?void 0:i.name)&&(0,s.jsx)("span",Object.assign({className:u},{children:(0,s.jsx)("span",{children:i.name})}))]}))}const g=e=>"e"===e.element.type?(0,s.jsx)(b,Object.assign({},e)):(0,s.jsx)(m,Object.assign({},e)),y=({attributes:e,children:t,leaf:n})=>{const{emotes:i}=n;return i?(0,s.jsxs)("span",Object.assign({},e,{className:l},{children:[(0,s.jsx)("span",{children:t}),(0,s.jsx)(O,{name:i.code,range:i.range})]})):(0,s.jsx)("span",Object.assign({},e,{children:t}))};function O({name:e,range:t}){const n=(0,o._7)(),[r,c]=(0,i.useState)([]);return(0,i.useEffect)((()=>{(0,p.zZ)(e).then(c)}),[]),(0,s.jsx)("div",Object.assign({contentEditable:!1,className:d.Z.label,"data-label-pos":"3"},{children:r.map(((e,i)=>(0,s.jsxs)("div",Object.assign({onClick:()=>h.insertEmote(n,e,t)},{children:[(0,s.jsx)(p.A0,Object.assign({},e)),(0,x.Ah)(e.type)]}),i)))}))}var v=n(1688);function E(){return function(e){const{normalizeNode:t,isVoid:n,isInline:s}=e;return e.normalizeNode=n=>{t(n),function(e,t){[N,k,w,C].forEach((n=>n(e,t)))}(e,n)},e.isVoid=e=>"e"===e.type||n(e),e.isInline=e=>"e"===e.type||s(e),e}((0,o.BU)((0,v.VC)((0,r.Jh)())))}function N(e,[t,n]){if(r.W_.isElement(t)&&"p"===t.type)for(const[t,s]of r.NB.children(e,n))if(r.W_.isElement(t)&&!e.isInline(t))return void r.YR.unwrapNodes(e,{at:s})}function k(e,[t,n]){if(!r.xv.isText(t))return;const[s,i]=r.ML.parent(e,n);"p"!==s.type&&r.YR.wrapNodes(e,{type:"p"},{at:n})}function w(e,[t,n]){if(!r.W_.isElement(t)||"e"!==t.type)return;const[s,i]=r.ML.parent(e,n);"p"!==s.type&&r.YR.wrapNodes(e,{type:"p"},{at:n})}function C(e,[t,n]){var s;if(!r.xv.isText(t))return;const i=V(t.text);for(let t of i){if(!(0,p.AE)(t[0]))continue;const i=null===(s=null==e?void 0:e.selection)||void 0===s?void 0:s.focus;if(!(i&&r.y$.equals(i.path,n)&&i.offset>t.index&&i.offset<=t.index+t[0].length))return void(0,p.zZ)(t[0]).then((([s])=>{6!==s.type&&h.insertEmote(e,s,{anchor:{path:n,offset:t.index},focus:{path:n,offset:t.index+t[0].length}})}))}}function V(e){return e.matchAll(/(\S+)/gim)}function _(e){return([t,n])=>{const s=[];for(let i of[z])s.push(...i([t,n],e));return s}}const z=([e,t],n)=>{if(!(r.xv.isText(e)&&n.selection&&r.y$.equals(n.selection.anchor.path,n.selection.focus.path)&&r.e6.includes(n.selection,t)))return[];const s=V(e.text);let i;for(let e of s)if(e.index<n.selection.focus.offset&&e.index+e[0].length+1>n.selection.focus.offset){i=e;break}if(!i)return[];if(!(0,p.AE)(i[0]))return[];const o={anchor:{path:t,offset:i.index},focus:{path:t,offset:i.index+i[0].length}};return[Object.assign(Object.assign({},o),{emotes:{code:i[0],range:o}})]};var A=n(4881),S=function(e,t){var n={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(n[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(s=Object.getOwnPropertySymbols(e);i<s.length;i++)t.indexOf(s[i])<0&&Object.prototype.propertyIsEnumerable.call(e,s[i])&&(n[s[i]]=e[s[i]])}return n};const Y=(0,i.memo)((e=>{var{initValue:t,onChange:n}=e,a=S(e,["initValue","onChange"]);const l=(0,i.useMemo)((()=>{const e=E();return e.children=[{type:"p",children:null!=t?t:[{text:""}]}],r.ML.normalize(e,{force:!0}),e}),[]);return(0,s.jsxs)("div",Object.assign({className:c},{children:[(0,s.jsx)(o.mH,Object.assign({editor:l,initialValue:l.children,onChange:n},{children:(0,s.jsx)(o.CX,Object.assign({},a,{decorate:_(l),renderLeaf:y,renderElement:g,spellCheck:!0,onFocus:()=>{(0,A.k)(5).preloadNames()},onKeyDown:e=>{if(e.ctrlKey)switch(e.key){case"я":case"z":e.preventDefault(),e.shiftKey?l.redo():l.undo()}}}))})),(0,s.jsx)(x.ih,{handler:(0,i.useCallback)((e=>h.insertEmote(l,e)),[l])})]}))})),L=Y}}]);