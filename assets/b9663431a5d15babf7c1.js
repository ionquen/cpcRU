"use strict";(self.webpackChunkc=self.webpackChunkc||[]).push([[365],{1365:(e,s,n)=>{n.r(s),n.d(s,{openSettingsPopup:()=>I});var t=n(5893),c=n(4047),i=n(5824),r=n(9391),a=n(3271),l=n(1996),o=n(4881),d=n(173);function h(){return(0,t.jsx)(t.Fragment,{children:(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{children:"Аккаунт"}),(0,t.jsx)(j,{})]})})}function j(){const e=(0,o.k)(3);return(0,a.SZ)(e),e.hasLogged?(0,t.jsxs)(r.z,Object.assign({onClick:s=>(0,l.j)(s,c.oC,(s=>(0,t.jsxs)(d.Qb,Object.assign({onClick:s},{children:[(0,t.jsx)(d.HC,Object.assign({onClick:()=>e.updateUser()},{children:"Обновить"})),(0,t.jsx)(d.HC,Object.assign({onClick:()=>e.logout()},{children:"Выйти"})),(0,t.jsx)(d.HC,Object.assign({onClick:()=>e.logoutAll()},{children:"Завершить все сессии"}))]}))))},{children:[(0,t.jsx)("div",Object.assign({className:"soc"},{children:"twitch"})),e.username]})):(0,t.jsxs)(r.z,Object.assign({onClick:()=>e.authTwitch()},{children:[(0,t.jsx)("div",Object.assign({className:"soc"},{children:"twitch"})),"Войти"]}))}var x=n(9917);class u{static delete(e){return(0,x.h)("storage",(s=>s.delete(e)))}static update(e,s){return(0,x.h)("storage",(n=>n.put(s,e)))}static get(e){return(0,x.h)("storage",(s=>s.get(e)))}}var g=n(7294),p=n(4938),b=n(7327);const f=1,v=["pastas","emotes","tags"];function k(e,s){var n,t,c;let[i,r,a]=s?[null!==(n=e.lastExportPastaId)&&void 0!==n?n:0,null!==(t=e.lastExportEmoteAdded)&&void 0!==t?t:0,null!==(c=e.lastExportTagId)&&void 0!==c?c:0]:[0,0,0];return new Promise(((e,n)=>{const t=(0,x.q)().transaction(v,"readonly");let c;t.objectStore("pastas").getAll(IDBKeyRange.lowerBound(i,!0)).onsuccess=function(){c=(0,b.Xz)(this.result)};let l=[];t.objectStore("emotes").openCursor(IDBKeyRange.lowerBound(r,!0)).onsuccess=function(){const e=this.result;e&&(r=e.key,l.push(e.value),e.continue())};let o=[];t.objectStore("tags").openCursor(IDBKeyRange.lowerBound(a,!0)).onsuccess=function(){const e=this.result;e&&(a=e.key,o.push(e.value),e.continue())},t.oncomplete=()=>{const n=Date.now();l=(0,b.Xz)(l),o=(0,b.Xz)(o);const t={stores:{pastas:c,emotes:l,tags:o},meta:{version:f,date:n,isPartial:s}},i=URL.createObjectURL(new Blob([JSON.stringify(t)],{type:"plain/text"}));(0,p.LR)(i,"copypastas_"+(new Date).toLocaleString()+".json");const d={lastExportDate:n};c&&(d.lastExportPastaId=c[c.length-1].id),l&&(d.lastExportEmoteAdded=r),o&&(d.lastExportTagId=a),e(d)},t.onerror=n}))}var m=n(1426),C=function(e,s,n,t){return new(n||(n=Promise))((function(c,i){function r(e){try{l(t.next(e))}catch(e){i(e)}}function a(e){try{l(t.throw(e))}catch(e){i(e)}}function l(e){var s;e.done?c(e.value):(s=e.value,s instanceof n?s:new n((function(e){e(s)}))).then(r,a)}l((t=t.apply(e,s||[])).next())}))};function O({type:e,name:s,source:n}){return`${e}:::${s}:::${n}`}function w(){return(0,p.ep)(!1).then((e=>e.item(0).text())).then((e=>JSON.parse(e))).then((e=>function(e){let s=e;for(let s=e.meta.version;s<f;s++)s+1;return s}(e))).then((e=>new Promise(((s,n)=>C(this,void 0,void 0,(function*(){const{meta:t,stores:i}=e,r=new Set;for(let e of yield(0,x.h)("emotes",(e=>e.getAll())))r.add(O(e));const a=(0,x.q)().transaction(v,"readwrite");if(i.pastas){const e=a.objectStore("pastas");for(let s of i.pastas)e.add(s)}if(i.emotes){const e=a.objectStore("emotes");for(let s of i.emotes)r.has(O(s))||e.add(s)}a.oncomplete=()=>{(0,c.E)("Выполнено"),s({lastExportDate:Date.now()})},a.onerror=n})))))).catch(m.d9)}function y(){return(0,t.jsx)(t.Fragment,{children:(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{children:"Импорт и экспорт"}),(0,t.jsx)("p",{children:'Не забывайте периодически экспортировать данные, браузер может посчитать, что данные, сохраняемые сайтом, не имеют ценности. Проблема решается, если браузер защитит хранилище от удаления. Для Firefox - нажать "сохранять данные" во всплывающем окне. Для остальных всё неоднозначно, поэтому стоит добавить сайт в закладки и установить на главный экран.'}),(0,t.jsx)(r.z,Object.assign({onClick:()=>{(0,c.EB)((()=>(0,t.jsx)(E,{})))}},{children:"Импорт и экспорт"}))]})})}function E(){const[e,s]=(0,g.useState)({});function n(n){const t=Object.assign(Object.assign({},e),n);u.update("backup",t),(0,o.k)(0).getModel("favs").updatePage({withTags:!0,withTotal:!0}),s(t)}(0,g.useEffect)((()=>{u.get("backup").then((e=>e&&s(e)))}),[]);const{lastExportDate:i}=e;return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{children:"Импорт и экспорт"}),(0,t.jsxs)("p",{children:["Экспорт и импорт позволяет",":"]}),(0,t.jsxs)("ul",{children:[(0,t.jsxs)("li",{children:["Экспортировать пасты и переносить их в другие браузеры и устройства",";"]}),(0,t.jsxs)("li",{children:["Создавать резервные копии локальной базы данных","."]})]}),i&&(0,t.jsxs)("p",{children:["Время последнего экспорта или импорта: ",(0,t.jsx)("b",{children:new Date(i).toLocaleString()})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{children:"Полный экспорт"}),(0,t.jsx)("p",{children:"Полный экспорт локальной базы данных."}),(0,t.jsx)(r.z,Object.assign({onClick:()=>k(e,!1).then(n)},{children:"Полный экспорт"}))]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{children:"Импорт"}),(0,t.jsx)("p",{children:"Импорт экспортированных данных в существующую базу данных, все импортируемые пасты, эмоджи, теги и.т.д будут добавлены как новые."}),(0,t.jsx)(r.z,Object.assign({onClick:()=>w().then(n)},{children:"Импорт"}))]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{children:"Частичный экспорт"}),(0,t.jsx)("p",{children:"Будут экспортированы только данные, добавленные после последнего экспорта или импорта. Можно использовать для синхронизации данных между устройствами и браузерами."}),(0,t.jsx)(r.z,Object.assign({onClick:()=>k(e,!0).then(n)},{children:"Частичный экспорт"}))]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{children:"Очистить локальное хранилище"}),(0,t.jsx)("p",{children:"Очистка соответствующего раздела локальной базы данных."}),(0,t.jsx)("p",{children:(0,t.jsx)(r.z,Object.assign({onClick:()=>(0,c.FW)("Очистить локальное хранилище").then((()=>(0,o.k)(1).clear().then((()=>(0,o.k)(0).updateLayer("favs")))))},{children:"Удалить все копипасты"}))}),(0,t.jsx)("p",{children:(0,t.jsx)(r.z,Object.assign({onClick:()=>(0,c.FW)("Удалить все копипасты").then((()=>(0,o.k)(5).clear().then((()=>(0,o.k)(0).updateLayer("favs"))).then((()=>(0,o.k)(0).updateLayer("global")))))},{children:"Удалить все эмоуты"}))}),(0,t.jsx)("p",{children:(0,t.jsx)(r.z,Object.assign({onClick:()=>(0,c.FW)("Удалить все эмоуты").then((()=>(0,o.k)(4).clear().then((()=>(0,o.k)(0).updateLayer("favs"))).then((()=>(0,o.k)(0).updateLayer("global")))))},{children:"Удалить все теги"}))})]})]})}var z=n(1611),S=n(4639),D=n(5732),B=n(2793);function L(){return(0,t.jsx)(t.Fragment,{children:(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{children:"Теги"}),(0,t.jsx)("p",{children:"Настройка тегов"}),(0,t.jsx)(r.z,Object.assign({onClick:()=>{(0,c.EB)((()=>(0,t.jsx)(F,{})))}},{children:"Теги"}))]})})}function F(){const e=(0,o.k)(4);return(0,a.SZ)(e),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{children:"Теги"}),(0,t.jsx)("p",{children:"Настройка тегов позволяет добавить к тегу кастомные изображения, эмоджи"})]}),(0,t.jsx)(r.z,Object.assign({onClick:()=>(0,c.EB)(((e,s)=>g.createElement((()=>{const[n,c]=(0,g.useState)(""),[i,a]=(0,g.useState)(),l=()=>{if(0===n.length||!i||(0,o.k)(4).test(n))return(0,m.d9)();e({name:n,source:i.source,type:i.type})};return(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{children:"Новый тег"}),(0,t.jsxs)("div",Object.assign({className:B.Z.gColumn},{children:[(0,t.jsx)(S.I,{value:n,onChange:c,placeholder:"Тег"}),(0,t.jsxs)(d.HC,{children:[(0,t.jsx)("div",{children:(i?"":"Иконка")+(i&&n.length?"":" + ")+(n.length?n:"Тег")}),i&&(0,t.jsx)(D.A0,Object.assign({},i)),i&&(0,t.jsx)(r.z,Object.assign({className:"ic",selected:!0,onClick:()=>a(void 0)},{children:"delete"}))]}),(0,t.jsx)(z.ih,{handler:a}),(0,t.jsxs)("div",Object.assign({className:B.Z.gInline},{children:[(0,t.jsx)(r.z,Object.assign({onClick:l},{children:"Добавить"})),(0,t.jsx)(r.z,Object.assign({onClick:s},{children:"Отменить"}))]}))]}))]})})))).then((e=>(0,o.k)(4).add(e)))},{children:"Добавить"})),(0,t.jsxs)(d.aV,{children:[0===e.getData().length&&(0,t.jsx)("div",Object.assign({className:B.Z.gEmptyContainer},{children:"Пусто"})),e.getData().map((s=>(0,t.jsxs)(d.HC,{children:[(0,t.jsx)("div",{children:s.name}),(0,t.jsx)(D.A0,Object.assign({},s)),(0,t.jsx)(r.z,Object.assign({className:"ic",onClick:()=>e.delete(s.name)},{children:"delete"}))]},s.name)))]})]})}function I(){return(0,i.k)("open_settings"),(0,c.EB)(((e,s)=>(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{children:(0,t.jsx)("h1",{children:"Настройки"})}),(0,t.jsx)(h,{}),(0,t.jsx)(y,{}),(0,t.jsx)(L,{})]})))}}}]);